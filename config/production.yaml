# ============================================================================
# InsightSerenity Platform - Production Configuration
# ============================================================================
# This file contains production-specific configuration overrides.
# Production settings prioritize security, performance, and stability.
#
# IMPORTANT: Never commit sensitive values to this file.
# All secrets must be provided via environment variables.
#
# @environment production
# @version 1.0.0
# ============================================================================

# ----------------------------------------------------------------------------
# Server Configuration - Production
# ----------------------------------------------------------------------------
server:
  customerServices:
    protocol: https
    trustProxy: true
    compression: true
  
  adminServer:
    protocol: https
    trustProxy: true
    compression: true

# ----------------------------------------------------------------------------
# Database Configuration - Production
# ----------------------------------------------------------------------------
database:
  connection:
    retryAttempts: 10
    retryDelay: 5000
    healthCheckInterval: 15000

  admin:
    name: insightserenity_admin_prod
    options:
      minPoolSize: 5
      maxPoolSize: 25
      maxIdleTimeMS: 60000
      waitQueueTimeoutMS: 15000
      serverSelectionTimeoutMS: 15000
      socketTimeoutMS: 60000
      heartbeatFrequencyMS: 10000
      retryWrites: true
      autoIndex: false  # Disable auto-indexing in production
      writeConcern:
        w: majority
        journal: true
        wtimeout: 10000
      readPreference: primaryPreferred
      readConcern:
        level: majority

  customer:
    name: insightserenity_customer_prod
    options:
      minPoolSize: 10
      maxPoolSize: 100
      maxIdleTimeMS: 60000
      waitQueueTimeoutMS: 15000
      serverSelectionTimeoutMS: 15000
      socketTimeoutMS: 60000
      heartbeatFrequencyMS: 10000
      retryWrites: true
      autoIndex: false
      writeConcern:
        w: majority
        journal: true
        wtimeout: 10000
      readPreference: primaryPreferred
      readConcern:
        level: majority

  shared:
    name: insightserenity_shared_prod
    options:
      minPoolSize: 5
      maxPoolSize: 50
      autoIndex: false

# ----------------------------------------------------------------------------
# Authentication - Production
# ----------------------------------------------------------------------------
auth:
  jwt:
    algorithm: HS512  # Stronger algorithm for production
    accessTokenExpiry: 15m
    refreshTokenExpiry: 7d

  session:
    maxAge: 28800000  # 8 hours

  password:
    minLength: 10
    requireUppercase: true
    requireLowercase: true
    requireNumbers: true
    requireSpecialChars: true
    saltRounds: 14
    maxAttempts: 3
    lockoutDuration: 1800000  # 30 minutes

  twoFactor:
    enabled: true
    enforceForAdmins: true

# ----------------------------------------------------------------------------
# Security Configuration - Production
# ----------------------------------------------------------------------------
security:
  helmet:
    enabled: true
    contentSecurityPolicy: true
    crossOriginEmbedderPolicy: true
    crossOriginOpenerPolicy: true
    crossOriginResourcePolicy: true
    dnsPrefetchControl: true
    frameguard:
      action: deny
    hidePoweredBy: true
    hsts:
      maxAge: 31536000  # 1 year
      includeSubDomains: true
      preload: true
    ieNoOpen: true
    noSniff: true
    originAgentCluster: true
    permittedCrossDomainPolicies: false
    referrerPolicy:
      policy: strict-origin-when-cross-origin
    xssFilter: true

  cors:
    origins:
      - https://insightserenity.com
      - https://www.insightserenity.com
      - https://app.insightserenity.com
      - https://admin.insightserenity.com
      - https://api.insightserenity.com
    maxAge: 86400

  rateLimit:
    windowMs: 900000  # 15 minutes
    max: 100
    skipSuccessfulRequests: false
    skipFailedRequests: false

  sanitization:
    mongoSanitize: true
    xssClean: true
    hpp: true

# ----------------------------------------------------------------------------
# Logging Configuration - Production
# ----------------------------------------------------------------------------
logging:
  level: warn
  format: json
  colorize: false
  timestamp: true
  prettyPrint: false

  file:
    enabled: true
    directory: /var/log/insightserenity
    maxSize: 50m
    maxFiles: 30d
    compress: true
    datePattern: YYYY-MM-DD

  transports:
    console:
      enabled: true
      level: warn
    file:
      combined:
        enabled: true
        level: info
      error:
        enabled: true
        level: error
      debug:
        enabled: false

  audit:
    enabled: true
    retentionDays: 365

# ----------------------------------------------------------------------------
# Caching - Production
# ----------------------------------------------------------------------------
cache:
  redis:
    enabled: true
    keyPrefix: insightserenity:prod:
    ttl: 3600
    maxRetries: 5
    retryDelay: 200
    enableReadyCheck: true
    enableOfflineQueue: true

  memory:
    enabled: true
    max: 2000
    ttl: 600000  # 10 minutes

# ----------------------------------------------------------------------------
# File Storage - Production
# ----------------------------------------------------------------------------
storage:
  provider: s3
  
  s3:
    bucket: insightserenity-prod-documents
    region: us-east-1
    acl: private
    serverSideEncryption: aws:kms
    signedUrlExpiry: 900  # 15 minutes

# ----------------------------------------------------------------------------
# Email - Production
# ----------------------------------------------------------------------------
email:
  provider: ses  # AWS SES for production
  from:
    name: InsightSerenity
    address: noreply@insightserenity.com
  replyTo: support@insightserenity.com

  queue:
    enabled: true
    concurrency: 10
    retryAttempts: 5
    retryDelay: 120000

# ----------------------------------------------------------------------------
# Health & Monitoring - Production
# ----------------------------------------------------------------------------
health:
  enabled: true
  path: /health
  checkInterval: 15000
  
  checks:
    database: true
    redis: true
    memory: true
    disk: true
    externalServices: true
  
  thresholds:
    memory: 85
    cpu: 85
    disk: 80
    eventLoop: 50

metrics:
  enabled: true
  path: /metrics
  collectInterval: 5000
  
  prometheus:
    enabled: true
    defaultLabels:
      app: insightserenity
      environment: production
  
  statsd:
    enabled: false

# ----------------------------------------------------------------------------
# Feature Flags - Production
# ----------------------------------------------------------------------------
features:
  registration: true
  emailVerification: true
  passwordReset: true
  twoFactorAuth: true
  
  clientManagement: true
  documentManagement: true
  recruitmentServices: true
  hostedOrganizations: true
  
  analytics: true
  reporting: true
  notifications: true
  realTimeUpdates: true
  
  # Beta features - disable by default in production
  aiAssistant: false
  advancedSearch: false
  bulkOperations: false

# ----------------------------------------------------------------------------
# Development Tools - Production
# ----------------------------------------------------------------------------
devTools:
  enabled: false
  
  swagger:
    enabled: false
  
  playground:
    enabled: false
  
  seedData:
    enabled: false
  
  debugRoutes:
    enabled: false

# ----------------------------------------------------------------------------
# Error Handling - Production
# ----------------------------------------------------------------------------
errors:
  showStack: false
  showDetails: false
  logLevel: error
  
  notifications:
    enabled: true
    channels:
      - email
      - slack
    threshold: 10  # Notify after 10 errors in 5 minutes

# ----------------------------------------------------------------------------
# Scheduled Tasks - Production
# ----------------------------------------------------------------------------
scheduler:
  enabled: true
  
  jobs:
    cleanup:
      enabled: true
      schedule: "0 2 * * *"  # 2 AM daily
      retentionDays: 90
    
    healthReport:
      enabled: true
      schedule: "0 8 * * 1"  # 8 AM every Monday
    
    databaseBackup:
      enabled: true
      schedule: "0 3 * * *"  # 3 AM daily
    
    auditLogArchive:
      enabled: true
      schedule: "0 4 * * 0"  # 4 AM every Sunday

# ----------------------------------------------------------------------------
# External Integrations - Production
# ----------------------------------------------------------------------------
integrations:
  stripe:
    enabled: true
    testMode: false
    webhookTolerance: 300
  
  errorTracking:
    sentry:
      enabled: true
      environment: production
      tracesSampleRate: 0.1
      profilesSampleRate: 0.1

# ----------------------------------------------------------------------------
# Cluster Configuration - Production
# ----------------------------------------------------------------------------
cluster:
  enabled: true
  workers: auto  # Use CPU count
  maxRestarts: 5
  restartWindow: 60000

# ----------------------------------------------------------------------------
# SSL/TLS Configuration - Production
# ----------------------------------------------------------------------------
ssl:
  enabled: true
  minVersion: TLSv1.2
  ciphers:
    - ECDHE-ECDSA-AES128-GCM-SHA256
    - ECDHE-RSA-AES128-GCM-SHA256
    - ECDHE-ECDSA-AES256-GCM-SHA384
    - ECDHE-RSA-AES256-GCM-SHA384